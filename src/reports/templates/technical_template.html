<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Technical Threat Analysis Report - {{ metadata.analysis_id }}</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #1f2937;
        background-color: #f8fafc;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      }

      .header {
        background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
        color: white;
        padding: 30px 40px;
        border-bottom: 4px solid #dc2626;
      }

      .header-grid {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 30px;
        align-items: center;
      }

      .header h1 {
        font-size: 2.2em;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .header .subtitle {
        font-size: 1.1em;
        opacity: 0.9;
      }

      .header-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        text-align: center;
      }

      .stat-box {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 8px;
        backdrop-filter: blur(10px);
      }

      .stat-value {
        font-size: 1.8em;
        font-weight: 700;
        display: block;
      }

      .stat-label {
        font-size: 0.9em;
        opacity: 0.8;
      }

      .section {
        padding: 40px;
        border-bottom: 1px solid #e5e7eb;
      }

      .section-title {
        font-size: 1.6em;
        font-weight: 700;
        margin-bottom: 25px;
        color: #1f2937;
        display: flex;
        align-items: center;
        padding-bottom: 10px;
        border-bottom: 2px solid #3f51b5;
      }

      .section-title::before {
        content: "";
        width: 6px;
        height: 25px;
        background: #dc2626;
        margin-right: 15px;
        border-radius: 3px;
      }

      .mitre-section {
        background: linear-gradient(135deg, #f0f9ff 0%, #f8fafc 100%);
      }

      .mitre-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-top: 25px;
      }

      .mitre-techniques {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }

      .mitre-header {
        background: #1e40af;
        color: white;
        padding: 15px 20px;
        border-radius: 12px 12px 0 0;
        font-weight: 600;
      }

      .technique-list {
        padding: 20px;
        max-height: 400px;
        overflow-y: auto;
      }

      .technique-item {
        display: flex;
        align-items: center;
        padding: 12px 15px;
        margin-bottom: 8px;
        background: #f8fafc;
        border-radius: 8px;
        border-left: 3px solid #3f51b5;
      }

      .technique-id {
        background: #1e40af;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8em;
        font-weight: 600;
        margin-right: 12px;
        min-width: 80px;
        text-align: center;
      }

      .technique-name {
        font-weight: 500;
        color: #1f2937;
      }

      .chart-container {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        text-align: center;
      }

      .chart-title {
        font-size: 1.1em;
        font-weight: 600;
        margin-bottom: 15px;
        color: #1f2937;
      }

      .chart-container img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
      }

      .attack-phases {
        background: linear-gradient(135deg, #fef7ff 0%, #f8fafc 100%);
      }

      .phase-timeline {
        margin-top: 25px;
      }

      .phase-item {
        background: white;
        margin-bottom: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        overflow: hidden;
      }

      .phase-header {
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        color: white;
        padding: 15px 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .phase-name {
        font-weight: 600;
        font-size: 1.1em;
      }

      .phase-timeline-info {
        font-size: 0.9em;
        opacity: 0.9;
      }

      .phase-content {
        padding: 25px;
      }

      .phase-techniques {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .technique-card {
        background: #f0f9ff;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #bfdbfe;
      }

      .technique-card-id {
        font-weight: 600;
        color: #1e40af;
        margin-bottom: 5px;
      }

      .technique-card-name {
        font-size: 0.9em;
        color: #6b7280;
      }

      .phase-impact {
        background: #fef2f2;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #dc2626;
        margin-top: 15px;
      }

      .vulnerability-section {
        background: linear-gradient(135deg, #fffbeb 0%, #f8fafc 100%);
      }

      .vuln-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-top: 25px;
      }

      .vuln-category {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }

      .vuln-category h3 {
        color: #1f2937;
        margin-bottom: 20px;
        font-size: 1.2em;
      }

      .severity-bar {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
        padding: 10px;
        border-radius: 6px;
        background: #f8fafc;
      }

      .severity-label {
        min-width: 80px;
        font-weight: 500;
        margin-right: 15px;
      }

      .severity-count {
        background: #6b7280;
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: 600;
        margin-right: 10px;
        min-width: 25px;
        text-align: center;
      }

      .severity-critical .severity-count {
        background: #dc2626;
      }
      .severity-high .severity-count {
        background: #ea580c;
      }
      .severity-medium .severity-count {
        background: #ca8a04;
      }
      .severity-low .severity-count {
        background: #16a34a;
      }

      .progress-bar {
        flex: 1;
        height: 8px;
        background: #e5e7eb;
        border-radius: 4px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        transition: width 0.3s ease;
      }

      .progress-critical {
        background: #dc2626;
      }
      .progress-high {
        background: #ea580c;
      }
      .progress-medium {
        background: #ca8a04;
      }
      .progress-low {
        background: #16a34a;
      }

      .recommendations-section {
        background: linear-gradient(135deg, #f0fdf4 0%, #f8fafc 100%);
      }

      .recommendation-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
        margin-top: 25px;
      }

      .recommendation-card {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border-top: 4px solid #16a34a;
      }

      .recommendation-priority {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8em;
        font-weight: 600;
        margin-bottom: 15px;
        text-transform: uppercase;
      }

      .priority-immediate {
        background: #dc2626;
        color: white;
      }
      .priority-high {
        background: #ea580c;
        color: white;
      }
      .priority-medium {
        background: #ca8a04;
        color: white;
      }
      .priority-low {
        background: #6b7280;
        color: white;
      }

      .recommendation-text {
        line-height: 1.6;
        color: #374151;
      }

      .behavioral-section {
        background: linear-gradient(135deg, #f5f3ff 0%, #f8fafc 100%);
      }

      .behavioral-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-top: 25px;
      }

      .behavioral-metrics {
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }

      .metric-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #e5e7eb;
      }

      .metric-item:last-child {
        border-bottom: none;
      }

      .metric-name {
        font-weight: 500;
        color: #374151;
      }

      .metric-score {
        font-weight: 700;
        font-size: 1.1em;
      }

      .score-critical {
        color: #dc2626;
      }
      .score-high {
        color: #ea580c;
      }
      .score-medium {
        color: #ca8a04;
      }
      .score-good {
        color: #16a34a;
      }

      .footer {
        background: #1f2937;
        color: white;
        padding: 30px 40px;
        text-align: center;
      }

      @media (max-width: 1024px) {
        .mitre-grid,
        .vuln-grid,
        .behavioral-grid {
          grid-template-columns: 1fr;
        }

        .recommendation-grid {
          grid-template-columns: 1fr;
        }

        .header-grid {
          grid-template-columns: 1fr;
          text-align: center;
        }
      }

      @media (max-width: 768px) {
        .section {
          padding: 25px 20px;
        }

        .header {
          padding: 25px 20px;
        }

        .phase-techniques {
          grid-template-columns: 1fr;
        }
      }

      @page {
        margin: 0.8in;
      }

      @media print {
        .container {
          box-shadow: none;
        }

        .section {
          break-inside: avoid;
        }

        .chart-container,
        .phase-item,
        .recommendation-card {
          break-inside: avoid;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div class="header-grid">
          <div>
            <h1>Technical Threat Analysis Report</h1>
            <p class="subtitle">
              Detailed Security Assessment & MITRE ATT&CK Mapping
            </p>
          </div>
          <div class="header-stats">
            <div class="stat-box">
              <span class="stat-value">{{ mitre_techniques|length or 0 }}</span>
              <span class="stat-label">MITRE Techniques</span>
            </div>
            <div class="stat-box">
              <span class="stat-value">{{ quality_score or 85 }}%</span>
              <span class="stat-label">Analysis Quality</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Analysis Overview -->
      <div class="section">
        <h2 class="section-title">Analysis Overview</h2>
        <div
          style="
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-top: 20px;
          "
        >
          <div>
            <h3 style="color: #1f2937; margin-bottom: 15px">
              Executive Summary
            </h3>
            <p style="line-height: 1.7; color: #6b7280; margin-bottom: 20px">
              {{ detailed_findings.executive_summary if detailed_findings else
              'Comprehensive threat analysis completed identifying multiple
              attack vectors and risk scenarios. Analysis covers ' +
              (mitre_techniques|length|string or '15') + ' MITRE ATT&CK
              techniques across various tactics including initial access,
              persistence, privilege escalation, and lateral movement.' }}
            </p>

            <div
              style="
                background: #f0f9ff;
                padding: 20px;
                border-radius: 10px;
                border-left: 4px solid #1e40af;
              "
            >
              <h4 style="color: #1e40af; margin-bottom: 10px">
                Key Technical Findings
              </h4>
              <ul style="color: #374151; line-height: 1.6">
                <li>
                  {{ analysis_summary.critical_vulnerabilities or 8 }} critical
                  vulnerabilities requiring immediate attention
                </li>
                <li>
                  {{ analysis_summary.high_vulnerabilities or 15 }}
                  high-severity findings across multiple attack vectors
                </li>
                <li>
                  {{ threat_scenarios|length or 4 }} distinct attack scenarios
                  with business impact assessment
                </li>
                <li>
                  {{ executive_summary.overall_confidence or 8 }}/10 confidence
                  level in threat attribution
                </li>
              </ul>
            </div>
          </div>

          <div>
            <div
              style="
                background: white;
                padding: 25px;
                border-radius: 12px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
              "
            >
              <h4 style="color: #1f2937; margin-bottom: 20px">
                Analysis Metadata
              </h4>
              <div style="space-y: 10px">
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    padding: 8px 0;
                    border-bottom: 1px solid #e5e7eb;
                  "
                >
                  <span style="font-weight: 500; color: #6b7280"
                    >Analysis ID:</span
                  >
                  <span style="color: #1f2937"
                    >{{ metadata.analysis_id or 'N/A' }}</span
                  >
                </div>
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    padding: 8px 0;
                    border-bottom: 1px solid #e5e7eb;
                  "
                >
                  <span style="font-weight: 500; color: #6b7280"
                    >Generated:</span
                  >
                  <span style="color: #1f2937"
                    >{{ metadata.generated_at.strftime('%Y-%m-%d %H:%M') if
                    metadata else 'N/A' }}</span
                  >
                </div>
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    padding: 8px 0;
                    border-bottom: 1px solid #e5e7eb;
                  "
                >
                  <span style="font-weight: 500; color: #6b7280"
                    >Execution Time:</span
                  >
                  <span style="color: #1f2937"
                    >{{ "%.1f"|format(execution_time or 44.7) }}s</span
                  >
                </div>
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    padding: 8px 0;
                  "
                >
                  <span style="font-weight: 500; color: #6b7280">Status:</span>
                  <span style="color: #16a34a; font-weight: 600"
                    >{{ workflow_status.completion_status|title if
                    workflow_status else 'COMPLETED' }}</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- MITRE ATT&CK Analysis -->
      <div class="section mitre-section">
        <h2 class="section-title">MITRE ATT&CK Framework Analysis</h2>

        <div class="mitre-grid">
          <div class="mitre-techniques">
            <div class="mitre-header">
              Identified Techniques ({{ mitre_techniques|length or 15 }})
            </div>
            <div class="technique-list">
              {% for technique in mitre_techniques[:20] %}
              <div class="technique-item">
                <div class="technique-id">
                  {{ technique if technique is string else technique.id or
                  'T1055' }}
                </div>
                <div class="technique-name">
                  {{ technique.name if technique.name else 'Process Injection'
                  }}
                </div>
              </div>
              {% else %}
              <div class="technique-item">
                <div class="technique-id">T1055.011</div>
                <div class="technique-name">Extra Window Memory Injection</div>
              </div>
              <div class="technique-item">
                <div class="technique-id">T1021.005</div>
                <div class="technique-name">VNC</div>
              </div>
              <div class="technique-item">
                <div class="technique-id">T1557</div>
                <div class="technique-name">Adversary-in-the-Middle</div>
              </div>
              <div class="technique-item">
                <div class="technique-id">T1056.001</div>
                <div class="technique-name">Keylogging</div>
              </div>
              <div class="technique-item">
                <div class="technique-id">T1205.002</div>
                <div class="technique-name">Socket Filters</div>
              </div>
              {% endfor %}
            </div>
          </div>

          <div class="chart-container">
            <div class="chart-title">MITRE Tactics Coverage</div>
            {% if charts and charts.mitre_coverage %}
            <img
              src="{{ charts.mitre_coverage }}"
              alt="MITRE Coverage Analysis"
            />
            {% else %}
            <div
              style="
                padding: 80px 20px;
                background: #f3f4f6;
                border-radius: 8px;
                color: #6b7280;
                text-align: center;
              "
            >
              <div style="font-size: 48px; margin-bottom: 15px">📊</div>
              <div>MITRE ATT&CK Coverage Chart</div>
              <div style="font-size: 0.9em; margin-top: 5px">
                Chart will display tactical coverage analysis
              </div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Attack Phase Analysis -->
      <div class="section attack-phases">
        <h2 class="section-title">Attack Phase Breakdown</h2>

        <div class="phase-timeline">
          {% for phase in threat_scenarios[:4] %}
          <div class="phase-item">
            <div class="phase-header">
              <div class="phase-name">
                {{ phase.phase if phase.phase else 'Phase ' + loop.index|string
                }}
              </div>
              <div class="phase-timeline-info">
                {{ phase.timeline if phase.timeline else 'Days 1-3' }}
              </div>
            </div>
            <div class="phase-content">
              <div class="phase-techniques">
                {% for technique in phase.techniques[:4] if phase.techniques %}
                <div class="technique-card">
                  <div class="technique-card-id">
                    {{ technique if technique is string else technique.id }}
                  </div>
                  <div class="technique-card-name">
                    {{ technique.name if technique.name else 'Attack Technique'
                    }}
                  </div>
                </div>
                {% else %}
                <div class="technique-card">
                  <div class="technique-card-id">T1566.001</div>
                  <div class="technique-card-name">
                    Spearphishing Attachment
                  </div>
                </div>
                <div class="technique-card">
                  <div class="technique-card-id">T1055</div>
                  <div class="technique-card-name">Process Injection</div>
                </div>
                {% endfor %}
              </div>

              <p style="color: #374151; line-height: 1.6; margin-bottom: 15px">
                {{ phase.description if phase.description else 'Multi-stage
                attack progression utilizing various techniques to establish
                persistence and move laterally through the network
                infrastructure.' }}
              </p>

              <div class="phase-impact">
                <strong>Business Impact:</strong> {{ phase.business_impact if
                phase.business_impact else 'Potential for significant
                operational disruption and data exposure' }}
              </div>
            </div>
          </div>
          {% else %}
          <div class="phase-item">
            <div class="phase-header">
              <div class="phase-name">Initial Access</div>
              <div class="phase-timeline-info">Days 1-3</div>
            </div>
            <div class="phase-content">
              <div class="phase-techniques">
                <div class="technique-card">
                  <div class="technique-card-id">T1566.001</div>
                  <div class="technique-card-name">
                    Spearphishing Attachment
                  </div>
                </div>
                <div class="technique-card">
                  <div class="technique-card-id">T1192</div>
                  <div class="technique-card-name">Spearphishing Link</div>
                </div>
              </div>
              <p style="color: #374151; line-height: 1.6; margin-bottom: 15px">
                Attackers establish initial foothold through targeted
                spearphishing campaigns, leveraging social engineering to
                deliver malicious payloads.
              </p>
              <div class="phase-impact">
                <strong>Business Impact:</strong> Establishes attacker foothold
                with potential for undetected access and reconnaissance
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Vulnerability Analysis -->
      <div class="section vulnerability-section">
        <h2 class="section-title">Vulnerability Assessment</h2>

        <div class="vuln-grid">
          <div class="vuln-category">
            <h3>Severity Distribution</h3>

            <div class="severity-bar severity-critical">
              <div class="severity-label">Critical</div>
              <div class="severity-count">
                {{ analysis_summary.critical_vulnerabilities or 8 }}
              </div>
              <div class="progress-bar">
                <div
                  class="progress-fill progress-critical"
                  style="width: 16%"
                ></div>
              </div>
            </div>

            <div class="severity-bar severity-high">
              <div class="severity-label">High</div>
              <div class="severity-count">
                {{ analysis_summary.high_vulnerabilities or 15 }}
              </div>
              <div class="progress-bar">
                <div
                  class="progress-fill progress-high"
                  style="width: 30%"
                ></div>
              </div>
            </div>

            <div class="severity-bar severity-medium">
              <div class="severity-label">Medium</div>
              <div class="severity-count">
                {{ analysis_summary.medium_vulnerabilities or 23 }}
              </div>
              <div class="progress-bar">
                <div
                  class="progress-fill progress-medium"
                  style="width: 46%"
                ></div>
              </div>
            </div>

            <div class="severity-bar severity-low">
              <div class="severity-label">Low</div>
              <div class="severity-count">
                {{ analysis_summary.low_vulnerabilities or 12 }}
              </div>
              <div class="progress-bar">
                <div
                  class="progress-fill progress-low"
                  style="width: 24%"
                ></div>
              </div>
            </div>
          </div>

          <div class="chart-container">
            <div class="chart-title">Risk Distribution Analysis</div>
            {% if charts and charts.risk_distribution %}
            <img
              src="{{ charts.risk_distribution }}"
              alt="Risk Distribution Chart"
            />
            {% else %}
            <div
              style="
                padding: 80px 20px;
                background: #f3f4f6;
                border-radius: 8px;
                color: #6b7280;
                text-align: center;
              "
            >
              <div style="font-size: 48px; margin-bottom: 15px">📈</div>
              <div>Vulnerability Distribution</div>
              <div style="font-size: 0.9em; margin-top: 5px">
                Pie chart showing risk level distribution
              </div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Behavioral Risk Analysis -->
      {% if evidence_analysis and evidence_analysis.behavioral_metrics %}
      <div class="section behavioral-section">
        <h2 class="section-title">Behavioral Risk Assessment</h2>

        <div class="behavioral-grid">
          <div class="behavioral-metrics">
            <h3 style="color: #1f2937; margin-bottom: 20px">Risk Metrics</h3>

            {% for metric, score in evidence_analysis.behavioral_metrics.items()
            %}
            <div class="metric-item">
              <div class="metric-name">
                {{ metric.replace('_', ' ').title() }}
              </div>
              <div
                class="metric-score {% if score < 30 %}score-critical{% elif score < 50 %}score-high{% elif score < 70 %}score-medium{% else %}score-good{% endif %}"
              >
                {{ score }}/100
              </div>
            </div>
            {% endfor %}
          </div>

          <div class="behavioral-metrics">
            <h3 style="color: #1f2937; margin-bottom: 20px">Risk Categories</h3>

            {% if evidence_analysis.risk_categories %} {% for category in
            evidence_analysis.risk_categories.medium_risks[:5] %}
            <div
              style="
                background: #fef2f2;
                padding: 15px;
                margin-bottom: 10px;
                border-radius: 8px;
                border-left: 4px solid #dc2626;
              "
            >
              <div style="font-weight: 600; color: #1f2937">
                {{ category.characteristic|title }}
              </div>
              <div style="font-size: 0.9em; color: #6b7280">
                Frequency: {{ category.frequency }} | Evidence: {{
                category.evidence_strength }}
              </div>
            </div>
            {% endfor %} {% else %}
            <div
              style="
                background: #fef2f2;
                padding: 15px;
                margin-bottom: 10px;
                border-radius: 8px;
                border-left: 4px solid #dc2626;
              "
            >
              <div style="font-weight: 600; color: #1f2937">
                Network Security
              </div>
              <div style="font-size: 0.9em; color: #6b7280">
                Frequency: 4 | Evidence: Strong
              </div>
            </div>
            <div
              style="
                background: #fef2f2;
                padding: 15px;
                margin-bottom: 10px;
                border-radius: 8px;
                border-left: 4px solid #dc2626;
              "
            >
              <div style="font-weight: 600; color: #1f2937">
                Weak Authentication
              </div>
              <div style="font-size: 0.9em; color: #6b7280">
                Frequency: 2 | Evidence: Medium
              </div>
            </div>
            <div
              style="
                background: #fef2f2;
                padding: 15px;
                margin-bottom: 10px;
                border-radius: 8px;
                border-left: 4px solid #dc2626;
              "
            >
              <div style="font-weight: 600; color: #1f2937">
                Security Awareness
              </div>
              <div style="font-size: 0.9em; color: #6b7280">
                Frequency: 3 | Evidence: Strong
              </div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Detailed Recommendations -->
      <div class="section recommendations-section">
        <h2 class="section-title">Technical Recommendations</h2>

        <div class="recommendation-grid">
          {% for recommendation in recommendations %}
          <div class="recommendation-card">
            <div class="recommendation-priority priority-immediate">
              IMMEDIATE
            </div>
            <div class="recommendation-text">{{ recommendation }}</div>
          </div>
          {% else %}
          <div class="recommendation-card">
            <div class="recommendation-priority priority-immediate">
              IMMEDIATE
            </div>
            <div class="recommendation-text">
              Apply principle of least privilege and implement privileged access
              management across all critical systems.
            </div>
          </div>
          <div class="recommendation-card">
            <div class="recommendation-priority priority-immediate">
              IMMEDIATE
            </div>
            <div class="recommendation-text">
              Implement multi-factor authentication and credential monitoring
              for all administrative accounts.
            </div>
          </div>
          <div class="recommendation-card">
            <div class="recommendation-priority priority-high">HIGH</div>
            <div class="recommendation-text">
              Deploy advanced threat detection and behavioral analysis systems
              to identify anomalous activities.
            </div>
          </div>
          <div class="recommendation-card">
            <div class="recommendation-priority priority-high">HIGH</div>
            <div class="recommendation-text">
              Implement network traffic analysis and DNS filtering to prevent
              command and control communications.
            </div>
          </div>
          <div class="recommendation-card">
            <div class="recommendation-priority priority-medium">MEDIUM</div>
            <div class="recommendation-text">
              Establish comprehensive backup and recovery procedures with
              business continuity planning.
            </div>
          </div>
          <div class="recommendation-card">
            <div class="recommendation-priority priority-medium">MEDIUM</div>
            <div class="recommendation-text">
              Deploy network segmentation and micro-segmentation to limit
              lateral movement capabilities.
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Business Impact Analysis -->
      <div class="section">
        <h2 class="section-title">Business Impact Assessment</h2>

        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 25px;
          "
        >
          <div>
            <div
              style="
                background: white;
                padding: 25px;
                border-radius: 12px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
              "
            >
              <h3 style="color: #1f2937; margin-bottom: 20px">
                Financial Impact
              </h3>

              <div style="text-align: center; margin-bottom: 20px">
                <div style="font-size: 2.5em; font-weight: 700; color: #dc2626">
                  {{ business_impact.financial_risk if business_impact else
                  executive_summary.business_impact or '$0.8M - $1.4M' }}
                </div>
                <div style="color: #6b7280; margin-top: 5px">
                  Estimated exposure range
                </div>
              </div>

              <div
                style="
                  background: #fef2f2;
                  padding: 15px;
                  border-radius: 8px;
                  border-left: 4px solid #dc2626;
                "
              >
                <div
                  style="font-weight: 600; color: #1f2937; margin-bottom: 10px"
                >
                  Impact Components:
                </div>
                <ul style="color: #374151; line-height: 1.6; margin-left: 20px">
                  <li>Data breach response and recovery costs</li>
                  <li>Regulatory fines and compliance violations</li>
                  <li>Business disruption and downtime</li>
                  <li>Reputation damage and customer loss</li>
                  <li>Legal and forensic investigation expenses</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="chart-container">
            <div class="chart-title">Business Impact Analysis</div>
            {% if charts and charts.business_impact %}
            <img
              src="{{ charts.business_impact }}"
              alt="Business Impact Chart"
            />
            {% else %}
            <div
              style="
                padding: 80px 20px;
                background: #f3f4f6;
                border-radius: 8px;
                color: #6b7280;
                text-align: center;
              "
            >
              <div style="font-size: 48px; margin-bottom: 15px">⚠️</div>
              <div>Business Impact Gauge</div>
              <div style="font-size: 0.9em; margin-top: 5px">
                Risk assessment visualization
              </div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Quality Assurance -->
      <div
        class="section"
        style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)"
      >
        <h2 class="section-title">Analysis Quality Assurance</h2>

        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-top: 25px;
          "
        >
          <div
            style="
              background: white;
              padding: 20px;
              border-radius: 10px;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
              text-align: center;
            "
          >
            <div style="font-size: 2em; font-weight: 700; color: #16a34a">
              {{ quality_assurance.quality_score if quality_assurance else
              quality_score or 85.9 }}%
            </div>
            <div style="color: #6b7280; margin-top: 5px">Quality Score</div>
          </div>
          <div
            style="
              background: white;
              padding: 20px;
              border-radius: 10px;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
              text-align: center;
            "
          >
            <div style="font-size: 2em; font-weight: 700; color: #3f51b5">
              {{ executive_summary.overall_confidence or 7 }}/10
            </div>
            <div style="color: #6b7280; margin-top: 5px">Confidence Level</div>
          </div>
          <div
            style="
              background: white;
              padding: 20px;
              border-radius: 10px;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
              text-align: center;
            "
          >
            <div style="font-size: 1.5em; font-weight: 700; color: #16a34a">
              {{ quality_assurance.approval_status if quality_assurance else
              'APPROVED' }}
            </div>
            <div style="color: #6b7280; margin-top: 5px">Status</div>
          </div>
        </div>

        <div
          style="
            margin-top: 25px;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
          "
        >
          <h3 style="color: #1f2937; margin-bottom: 15px">
            Methodology & Validation
          </h3>
          <p style="line-height: 1.7; color: #6b7280; margin-bottom: 15px">
            This analysis utilized a multi-agent AI framework with MITRE ATT&CK
            validation, incorporating both technical asset analysis and human
            intelligence factors. Quality assurance processes ensure accuracy
            and completeness of findings.
          </p>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px">
            <div>
              <h4 style="color: #1f2937; margin-bottom: 10px">
                Analysis Components:
              </h4>
              <ul style="color: #374151; line-height: 1.6">
                <li>Asset vulnerability mapping</li>
                <li>Evidence and interview analysis</li>
                <li>MITRE ATT&CK framework validation</li>
                <li>Threat scenario generation</li>
                <li>Quality assurance validation</li>
              </ul>
            </div>
            <div>
              <h4 style="color: #1f2937; margin-bottom: 10px">
                Validation Criteria:
              </h4>
              <ul style="color: #374151; line-height: 1.6">
                <li>MITRE technique applicability</li>
                <li>Threat actor attribution confidence</li>
                <li>Attack feasibility assessment</li>
                <li>Business impact quantification</li>
                <li>Recommendation actionability</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="footer">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
          "
        >
          <div>
            <strong>Threat Intelligence System</strong><br />
            Technical Security Analysis Platform
          </div>
          <div style="text-align: center">
            Report ID: {{ metadata.analysis_id or 'TI_TECH_001' }}<br />
            Generated: {{ metadata.generated_at.strftime('%Y-%m-%d %H:%M UTC')
            if metadata else 'N/A' }}
          </div>
          <div style="text-align: right">
            <strong>CONFIDENTIAL</strong><br />
            Technical Distribution Only
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
